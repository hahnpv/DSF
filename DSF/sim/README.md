This is the core of the time-domain simulation kernel
